<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="/lib/geo.ext.min.js" type="text/javascript" charset="UTF8"></script>
    <script src="/lib/geo.min.js"></script>
    <style>
        html{
            height: 100%;
        }
    </style>

</head>
<body style="height: 100%;">
<script>
var myMap;
$(function() {
    var mapOptions = {node: '#map',
                      zoom : 3,
                      center : [0.0, 0.0]},
        layer;
    myMap = geo.map(mapOptions);

    /// Resize the canvas to fill browser window dynamically
    window.addEventListener('resize', resizeCanvas, false);

    function resizeCanvas() {
      $('#map').width('100%');
      $('#map').height('100%');
      updateAndDraw($('#map').width(), $('#map').height());
    }

    function updateAndDraw(width, height) {
      myMap.resize(0, 0, width, height);
      myMap.draw();
    }

    resizeCanvas();
    layer = myMap.createLayer('osm');
    myMap.draw();

    $.get( "BRFSS_MMSA_2010.geojson", function (data) {
      myMap
        .createLayer("feature")
          .createFeature("point", {selectionAPI: true})
            .data(JSON.parse(data).features)
            .geoOn(geo.event.pointFeature.mouseover, function(d) {
              console.log(d.data.properties);
            })
            .style("fillColor", function (d) {
              if (parseFloat(d.properties.A868_1) > parseFloat(d.properties.A868_2)) {
                return {r: 0.4, g:0.8, b:0.4};
              }
              return {r: 0.8, g:0.4, b:0.4};
            })
            .style("radius", function (d) {
              if (parseFloat(d.properties.A868_1) > parseFloat(d.properties.A868_2)) {
                return Math.ceil(parseFloat(d.properties.A868_1) * 0.2);
              }
              return Math.ceil(parseFloat(d.properties.A868_2) * 0.2);
            })
            .style("strokeWidth", function (d) {
              if (parseFloat(d.properties.A868_1) > parseFloat(d.properties.A868_2)) {
                return Math.ceil(0.2 * parseFloat(d.properties.A868_2));
              }
              return Math.ceil(0.2 * parseFloat(d.properties.A868_1));
            })
            .style("strokeColor", function (d) {
              if (parseFloat(d.properties.A868_1) > parseFloat(d.properties.A868_2)) {
                return {r: 0.8, g:0.4, b:0.4};
              }
              return {r: 0.4, g:0.8, b:0.4};
            })
            .position(function (d) {
              return {x: d.properties.LON, y: d.properties.LAT};
            });
      myMap.draw();
    });
});
</script>

<div id='map'></div>
</body>
